<template>
  <div>
    <div class="main-content horizontal-content">
      <div class="container">
        <div class="breadcrumb-header justify-content-between">
          <div class="my-auto">
            <div class="d-flex">
              <h4 class="content-title mb-0 my-auto">Cài đặt tài khoản</h4>
            </div>
          </div>
        </div>
        <div class="row row-sm">
          <div class="col-sm-12">
            <div class="card">
              <div class="card-body">
                <div class="tabs-menu">
                  <ul class="nav nav-tabs profile navtab-custom panel-tabs">
                    <li>
                      <a
                        href="#resource"
                        data-toggle="tab"
                        aria-expanded="false"
                        class="active"
                      >
                        <span class="visible-xs">
                          <i class="fas fa-question-circle"></i>
                        </span>
                        <span class="hidden-xs">HỎI ĐÁP</span>
                      </a>
                    </li>
                    <li>
                      <a
                        href="#feedback"
                        data-toggle="tab"
                        aria-expanded="false"
                      >
                        <span class="visible-xs">
                          <i class="fas fa-comment-dots"></i>
                        </span>
                        <span class="hidden-xs">PHẢN HỒI</span>
                      </a>
                    </li>
                  </ul>
                </div>
                <div
                  class="tab-content border-left border-bottom border-right border-top-0 p-4"
                >
                  <div id="resource" class="tab-pane active">
                    <div class="mb-4 main-content-label">HỎI ĐÁP</div>
                    <span class="text-muted mt-1 tx-13 mb-0"
                      >2020-06-29 14:37:10</span
                    >
                    <div class="eamil-body">
                      <p>
                        <strong>1. Timebeats là gì?</strong>
                      </p>

                      <p>
                        <strong>Đáp:</strong>&nbsp;Timebeats là nền tảng giúp
                        cho các thành viên tận dụng thời gian rãnh rỗi của mình
                        để kiếm thêm thu nhập bằng cách thực hiện một số nhiệm
                        vụ đơn giản như đăng ký tài khoản, xem quảng cáo, tải
                        app... hoặc có thể tiết kiệm tiền bằng cách tham gia
                        chương trình hoàn tiền khi mua sắm tại hàng nghìn cửa
                        hàng online, offline có liên kết với Timebeats
                      </p>

                      <p>
                        <strong>2. Kiếm tiền với Timebeats như thế nào?</strong>
                      </p>

                      <p>
                        <strong>Đáp:</strong> Có 3 cách chính để kiếm tiền với
                        Timebeats:
                      </p>

                      <p>
                        - Cách 1: Tham gia thực hiện các Nhiệm vụ của Timebeats
                        đưa ra như: tải app nhận từ 5.000đ
                        đến&nbsp;50.000đ/lượt, trả lời khảo sát từ 5.000đ đến
                        100.000đ bài khảo sát, xem quảng cáo từ 50đ đến
                        1.000đ/lượt xem...
                      </p>

                      <p>
                        - Cách 2: Dùng tính năng hoàn tiền của Timebeats để mua
                        sắm tại các trang thương mại điện tử hàng đầu Việt Nam
                        cũng như các các cửa hàng offline liên kết với Timebeats
                        để được hoàn tiền từ 3% - 50% tuỳ vào từng đối tác.
                      </p>

                      <p>
                        - Cách 3: Giới thiệu bạn bè tham gia kiếm tiền với
                        Timebeats và nhận thưởng 3% trên tổng doanh số của tất
                        cả các thành viên trong hệ thống 7&nbsp;tầng của bạn. Ví
                        dụ: bạn giới thiệu được 10 ng bạn, 10 người bạn này mỗi
                        người giới thiệu được 10 người nữa thì bạn sẽ có 110
                        người trong team. Mỗi 1 người 1 tháng kiếm được từ
                        Timebeats 1.000.000đ thì bạn sẽ có được khoản thưởng
                        team là: 110 x 1.000.000đ x 3% = 3.300.000đ
                      </p>

                      <p>
                        <strong>
                          3. Timebeats có thu phí hay bán hàng gì cho tôi không?
                        </strong>
                      </p>

                      <p>
                        <strong>Đáp:</strong>&nbsp;Timebeats là chương trình
                        hoàn toàn miễn phí, vĩnh viễn không thu bất kỳ khoản phí
                        nào của thành viên. Timebeats cũng hoàn toàn không bán
                        bất kỳ sản phẩm nào cho thành viên mà chỉ giới thiệu đến
                        các thành viên các sản phẩm, dịch vụ của các đối tác
                        liên kết uy tín, có thương hiệu nổi tiếng trên thị
                        trường. Chính nhất, Timebeats sẽ cung cấp các chiến
                        dịch, nhiệm vụ giúp cho các thành viên tham gia kiếm
                        tiền hoàn toàn miễn phí.
                      </p>

                      <p>
                        <strong
                          >4. Tôi có thể kiếm được bao nhiêu tiền với
                          Timebeats?</strong
                        >
                      </p>

                      <p>
                        <strong>Đáp:</strong>&nbsp;Việc này là do bạn. Với mỗi
                        hành động như tải app, xem quảng cáo, làm khảo sát...
                        bạn sẽ nhận được từ 1000đ đến 500.000đ tuỳ vào từng
                        chiến dịch. Thời gian và công sức bạn bỏ ra sẽ tương
                        xứng với những gì bạn có thể nhận được. Ngoài ra,
                        Timebeats còn cho phép bạn xây dựng đội nhóm cùng kiếm
                        tiền chung với bạn và bạn sẽ được hưởng % thu nhập trên
                        tổng nhóm mà bạn xây dựng.
                      </p>

                      <p>
                        <strong>
                          5. Số tiền tối thiểu tôi được rút là bao nhiu?
                        </strong>
                      </p>

                      <p>
                        <strong>Đáp:&nbsp;</strong>Với Timebeats, số tiền tối
                        thiểu bạn có thể rút về&nbsp;chỉ là 100.000đ đối với
                        phương thức thanh toán qua VNDC Wallet Pro và 200.000đ
                        đối với tài khoản ngân hàng. Một con số cực kỳ nhỏ mà
                        bạn có thể dễ dàng thực hiện chỉ trong vài bước đơn
                        giản.
                      </p>

                      <p>
                        <strong>
                          6. Tôi có thể rút tiền về bằng cách nào?
                        </strong>
                      </p>

                      <p>
                        <strong>Đáp:</strong>&nbsp;Timebeats hợp tác chiến lược
                        với VNDC, một nền tảng stable coin bảng vị Việt Nam Đồng
                        cực kỳ uy tín trên thị trường. Việc rút tiền từ
                        Timebeats về ví VNDC sẽ được thực hiện trong một khoản
                        thời gian cực kỳ nhanh chóng.
                      </p>

                      <p>
                        <strong>
                          7. Tôi giới thiệu bạn bè tham gia thì có được gì
                          không?
                        </strong>
                      </p>

                      <p>
                        <strong>Đáp:</strong>&nbsp;Tất nhiên là được, với
                        Timebeats, khi bạn giới thiệu thành viên mới tham gia
                        kiếm tiền cùng với bạn, bạn sẽ được hưởng thu nhập lên
                        đến 3% thu nhập của tất cả các thành viên mà bạn giới
                        thiệu, hoa hồng được tính cho các thành viên trong team
                        đến 7&nbsp;tầng hệ thống.
                      </p>

                      <p>
                        <strong>
                          8. Timebeats có phải bán hàng đa cấp không?
                        </strong>
                      </p>

                      <p>
                        <strong>Đáp:</strong> Timebeats ứng dụng phương thức
                        phát triển Affiliate nhiều level để giúp các thành viên
                        có thể dễ dàng xây dựng đội nhóm cùng làm việc và tạo
                        nên những khoản thu nhập lớn và thụ động. Tuy nhiên,
                        Timebeats hoàn toàn không bán hàng, không thu bất kỳ
                        khoản phí nào của thành viên, Timebeats hoàn toàn không
                        phải là bán hàng đa cấp. Timebeats chỉ là kênh marketing
                        phát triển thị trường cho các&nbsp;đối tác là các doanh
                        nghiệp&nbsp;lớn và uy tín trên thị trường và chia lại
                        các khoản thu nhập từ dịch vụ marketing này.
                      </p>

                      <p>&nbsp;</p>
                    </div>
                  </div>
                  <div id="feedback" class="tab-pane">
                    <div class="mb-4 main-content-label">PHẢN HỒI</div>
                    <div
                      class="card card-body pd-20 pd-md-40 border shadow-none"
                    >
                      <form class="form-horizontal">
                        <label
                          class="main-content-label tx-12 tx-medium tx-gray-600"
                          >Tiêu đề</label
                        >
                        <div class="form-group">
                          <input
                            type="text"
                            placeholder="Tiêu đề"
                            class="form-control"
                            v-model="title"
                          />
                        </div>
                        <div class="form-group">
                          <label
                            class="main-content-label tx-12 tx-medium tx-gray-600"
                            >Nội dung</label
                          >
                          <textarea
                            class="form-control"
                            v-model="content"
                          ></textarea>
                        </div>
                        <div class="form-group">
                          <label
                            class="main-content-label tx-12 tx-medium tx-gray-600"
                            for="img-inputed"
                            >Chọn ảnh</label
                          >
                          <input
                            type="file"
                            @change="uploadImage($event)"
                            id="img-inputed"
                          />
                          <div class="form-control img-feedback">
                            <img
                              v-for="src in url"
                              :key="src"
                              :src="src"
                              data-toggle="modal"
                              data-target="#show-img-modal"
                            />
                            <i
                              v-if="url[0]"
                              class="fas fa-times"
                              @click="deleteImg"
                            ></i>
                          </div>
                          <div
                            class="modal fade"
                            id="show-img-modal"
                            tabindex="-1"
                            aria-labelledby="exampleModalLabel"
                            aria-hidden="true"
                          >
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title">ẢNH PHẢN HỒI</h5>
                                  <button
                                    type="button"
                                    class="close"
                                    data-dismiss="modal"
                                    aria-label="Close"
                                  >
                                    <span aria-hidden="true">&times;</span>
                                  </button>
                                </div>
                                <div class="modal-body">
                                  <div
                                    id="carouselExampleIndicators"
                                    class="carousel slide"
                                    data-ride="carousel"
                                  >
                                    <div class="carousel-inner">
                                      <div class="carousel-item active">
                                        <img
                                          :src="url[0]"
                                          class="d-block w-100"
                                        />
                                      </div>
                                      <div
                                        class="carousel-item"
                                        v-for="src in url"
                                        :key="src"
                                      >
                                        <img :src="src" class="d-block w-100" />
                                      </div>
                                    </div>
                                    <a
                                      class="carousel-control-prev"
                                      href="#carouselExampleIndicators"
                                      role="button"
                                      data-slide="prev"
                                    >
                                      <span
                                        class="carousel-control-prev-icon"
                                        aria-hidden="true"
                                        ><i class="fas fa-chevron-left"></i
                                      ></span>
                                      <span class="sr-only">Previous</span>
                                    </a>
                                    <a
                                      class="carousel-control-next"
                                      href="#carouselExampleIndicators"
                                      role="button"
                                      data-slide="next"
                                    >
                                      <span
                                        class="carousel-control-next-icon"
                                        aria-hidden="true"
                                        ><i class="fas fa-chevron-right"></i
                                      ></span>
                                      <span class="sr-only">Next</span>
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <p
                          class="text-danger"
                          v-for="item in errors"
                          :key="item"
                        >
                          {{ item }}
                        </p>
                        <div class="form-group mb-0 mt-3 justify-content-end">
                          <div>
                            <button
                              type="submit"
                              class="btn btn-primary"
                              @click="feedbackHandle"
                            >
                              Xác nhận
                            </button>
                          </div>
                        </div>
                      </form>
                    </div>
                    <div class="mb-4 main-content-label pad-top-20">
                      DANH SÁCH PHẢN HỒI CỦA BẠN
                    </div>
                    <!-- <div
                      class="card card-body pd-20 pd-md-40 border shadow-none"
                    > -->
                    <table class="table feedback-table" v-if="active">
                      <thead>
                        <tr>
                          <td>STT</td>
                          <td scope="col">Tiêu đề</td>
                          <td scope="col">Trạng thái</td>
                          <td scope="col">Thời gian</td>
                        </tr>
                      </thead>
                      <tbody>
                        <tr
                          v-for="(item, index) in listFeedback"
                          :key="item._id"
                          @click="detailFeedback(item._id)"
                        >
                          <td>{{ index + 1 }}</td>
                          <td>{{ item.title }}</td>
                          <td v-if="item.status == 'answer'">Đã trả lời</td>
                          <td v-else>Đang chờ</td>
                          <td>{{ formatDate(item.created_at) }}</td>
                        </tr>
                      </tbody>
                    </table>

                    <table class="table detail-feedback" v-if="!active">
                      <tbody>
                        <tr>
                          <td class="td-img">
                            <span
                              v-if="!active"
                              id="return-list"
                              @click="returnList"
                              ><i class="fas fa-arrow-left"></i
                            ></span>
                          </td>
                          <td>
                            <h5
                              class="card-title mg-b-20 pad-top-20 tx-gray-600"
                              v-if="!active"
                            >
                              {{ listDetailFeedback.title }}
                            </h5>
                          </td>
                        </tr>
                        <tr>
                          <td rowspan="2" class="td-img pad-top-20">
                            <img alt :src="avatar" />
                          </td>
                          <td class="pad-top-20">
                            <b>{{ name }}</b
                            ><br /><label
                              class="main-content-label tx-12 tx-medium tx-gray-600"
                              >{{
                                formatDate(listDetailFeedback.created_at)
                              }}</label
                            >
                          </td>
                        </tr>
                        <tr>
                          <td class="content">
                            {{ listDetailFeedback.content }}
                          </td>
                        </tr>
                        <tr>
                          <td rowspan="10" class="pad-top-20 td-img">
                            <img
                              alt
                              src="https://cf.shopee.vn/file/01566b94a0243a192eae029c72fc4503_tn"
                            />
                          </td>
                          <td class="pad-top-20">
                            <b>Admin</b><br /><label
                              class="tx-12 tx-medium tx-gray-600"
                              >
                              <span v-if="listDetailFeedback.status == 'answer'">Đã trả lời</span>
                              <span v-else>Đang chờ...</span>
                              </label
                            >
                          </td>
                        </tr>
                        <tr
                          v-for="item in listDetailFeedback.activity"
                          :key="item._id"
                        >
                          <td>{{ item.content }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <!-- </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      avatar: "http://192.168.100.11:3000/" + this.$store.getters.avatar,
      name: this.$store.getters.name,
      title: "",
      content: "",
      srcImg: {},
      listSrcImg: [],
      url: [],
      errors: [],
      listFeedback: [],
      active: true,
      listDetailFeedback: [],
    };
  },
  mounted() {
    this.$axios
      .get("http://192.168.100.11:3000/api/faq/feedback", {
        headers: {
          Authorization:
            this.$store.getters.id + " " + this.$store.getters.token,
        },
      })
      .then((response) => {
        this.listFeedback = response.data.data;
        console.log(this.listFeedback);
      });
  },
  methods: {
    uploadImage(event) {
      this.srcImg = event.target.files[0];
      this.listSrcImg.push(this.srcImg);
      this.url.push(URL.createObjectURL(this.srcImg));
    },
    feedbackHandle(e) {
      e.preventDefault();
      console.log(this.listSrcImg);
      this.errors = [];
      if (!this.title || !this.content) {
        this.errors.push("Vui lòng nhập đủ thông tin !");
        return;
      }

      const URL = "http://192.168.100.11:3000/api/faq/feedback";

      let data = new FormData();
      data.append("title", this.title);
      data.append("content", this.content);
      data.append("image", this.srcImg);

      let config = {
        headers: {
          Authorization:
            this.$store.getters.id + " " + this.$store.getters.token,
        },
      };

      this.$axios
        .post(URL, data, config)
        .then((response) => {
          this.$toast.success("Gửi phản hồi thành công!", {
            position: "top-right",
            timeout: 3000,
            closeOnClick: true,
            pauseOnFocusLoss: true,
            pauseOnHover: true,
            draggable: true,
            draggablePercent: 0.82,
            showCloseButtonOnHover: true,
            hideProgressBar: false,
            closeButton: "button",
            icon: true,
            rtl: false,
          });
          this.title = "";
          this.content = "";
          this.url = [];

          this.$axios
            .get("http://192.168.100.11:3000/api/faq/feedback", {
              headers: {
                Authorization:
                  this.$store.getters.id + " " + this.$store.getters.token,
              },
            })
            .then((response) => {
              this.listFeedback = response.data.data;
              console.log(this.listFeedback);
            });
        })
        .catch(() => {});
    },
    deleteImg() {
      this.url = [];
    },
    formatDate(value) {
      return value.slice(0, 10);
    },
    detailFeedback(id) {
      this.active = false;
      this.$axios
        .get(`http://192.168.100.11:3000/api/faq/feedback-detail/${id}`, {
          headers: {
            Authorization:
              this.$store.getters.id + " " + this.$store.getters.token,
          },
        })
        .then((response) => {
          this.listDetailFeedback = response.data.data[0];
          console.log(this.listDetailFeedback);
        });
    },
    returnList() {
      this.active = true;
    },
  },
};
</script>

<style>
#feedback textarea {
  height: 100px;
}
#feedback .card {
  width: 52%;
  margin: 0 auto;
}
#list-feedback i {
  font-size: 15px;
  margin-right: 5px;
}
#list-feedback p {
  margin-left: 20px;
  font-size: 12px;
}
.img-feedback {
  height: auto;
  min-height: 50px;
}
.img-feedback img {
  max-width: 50px;
  max-height: 50px;
  margin-right: 10px;
  cursor: pointer;
}
.img-feedback i:hover {
  opacity: 0.8;
  transition: all 100ms ease;
}
.img-feedback i {
  float: right;
  cursor: pointer;
}
#img-inputed {
  display: none;
}
#show-img-modal img {
  max-width: 500px;
  max-height: 500px;
  display: block;
  margin: 0 auto;
}
.carousel-control-next-icon i,
.carousel-control-prev-icon i {
  font-size: 40px;
  color: #333;
}
.feedback-table thead td {
  height: 40px;
  line-height: 40px;
  color: #fff;
  text-align: center;
}
.feedback-table thead {
  background: #22c03c;
}
.feedback-table tbody tr:hover {
  cursor: pointer;
  border: none;
  box-shadow: inset 0 1px 0 0 #dadce0, inset 0 -1px 0 0 #dadce0,
    0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
}
.feedback-table tbody tr td:not(:nth-child(2)) {
  text-align: center;
}
#return-list {
  display: block;
  height: 40px;
  width: 40px;
  text-align: center;
  line-height: 40px;
  cursor: pointer;
  border-radius: 50%;
  color: #666;
  transition: 200ms all ease;
  font-size: 18px;
  margin-top: 8px;
}
#return-list:hover {
  color: rgb(80, 80, 80);
}
.detail-feedback img {
  height: 40px;
  width: 40px;
  border-radius: 50%;
}
.detail-feedback tr:not(:nth-child(4)) td {
  border: none;
}
.detail-feedback tr:nth-child(1) td {
  border-top: 1px solid #dde2ef;
}
.detail-feedback tr:nth-child(2) td {
  border-top: 1px solid #dde2ef;
}
.detail-feedback td {
  padding: 5px 20px;
}
.detail-feedback .td-img {
  width: 40px;
  padding: 5px 0;
  border-top: 1px solid #dde2ef;
}
.detail-feedback .content {
  padding-bottom: 20px;
}
.pad-top-20 {
  padding-top: 20px;
}
.detail-feedback .pad-top-20 {
  padding-top: 20px;
}
@media (min-width: 576px) {
  #show-img-modal .modal-dialog {
    max-width: 55%;
  }
}
</style>